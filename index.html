<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å­—æ—æ¢ç§˜ä¹‹æ—…</title>
    <style>
        body { font-family: 'SimSun', serif; background-color: #f4e7c7; color: #333; text-align: center; margin: 0; padding: 0; }
        .stage-intro { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(30, 20, 10, 0.95); color: #f4e7c7; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 3000; }
        .stage-card { background: #8b4513; padding: 30px; border: 4px double #f4e7c7; border-radius: 20px; width: 80%; max-width: 500px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        #game-container { display: none; max-width: 900px; margin: 20px auto; background: #fff8e8; border: 6px solid #a0522d; padding: 25px; border-radius: 12px; min-height: 85vh; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .task-page { padding: 15px; text-align: left; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .scene-header { font-weight: bold; color: #a0522d; border-bottom: 2px solid #a0522d; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .drop-zone { min-width: 100px; min-height: 40px; border: 2px dashed #a0522d; display: inline-flex; align-items: center; justify-content: center; background: #fffaf0; vertical-align: middle; margin: 5px; padding: 2px 10px; border-radius: 4px; font-weight: bold; color: #a0522d; }
        .tray { display: flex; flex-wrap: wrap; gap: 10px; padding: 15px; background: #eee4cc; border-radius: 8px; justify-content: center; margin: 15px 0; border: 1px solid #d2b48c; }
        .draggable { padding: 8px 15px; background: #a0522d; color: white; cursor: grab; border-radius: 4px; font-weight: bold; box-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .btn-group { display: flex; justify-content: space-between; margin-top: 30px; border-top: 2px solid #a0522d; padding-top: 20px; }
        .nav-btn { padding: 10px 20px; background: #8e735d; color: white; border: none; cursor: pointer; border-radius: 4px; }
        .nav-btn:disabled { background: #ccc; cursor: not-allowed; }
        .check-btn { padding: 12px 30px; background: #5d8e7c; color: white; border: none; cursor: pointer; font-weight: bold; border-radius: 4px; }
        .answer-btn { padding: 6px 12px; background: #d4a017; color: white; border: none; cursor: pointer; font-size: 0.8em; border-radius: 4px; font-weight: bold; }
        #stage-clear { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; background: white; border: 5px solid #5d8e7c; padding: 30px; z-index: 100; border-radius: 15px; text-align: center; }
        .clue-box { display: inline-block; width: 70px; height: 90px; line-height: 90px; border: 3px solid #a0522d; margin: 10px; font-size: 2.5em; background: #fff; text-align: center; border-radius: 8px; font-weight: bold; color: #a0522d; }
        .hidden { display: none !important; }
        input[type="text"], select { padding: 8px; border: 1px solid #a0522d; border-radius: 4px; outline: none; }
    </style>
</head>
<body>

    <audio id="bgm" loop src="bgm.mp3"></audio>
    <audio id="snd-click" src="click.mp3"></audio>
    <audio id="snd-success" src="success.mp3"></audio>
    <audio id="snd-fail" src="fail.mp3"></audio>

    <div id="start-screen" style="padding-top: 150px;">
        <h1 style="font-size: 4em; color: #a0522d;">å­—æ—æ¢é™©</h1>
        <button onclick="initGame()" style="padding:15px 50px; font-size:1.5em; background:#a0522d; color:white; border:none; border-radius:10px; cursor:pointer;">å¼€å¯æ¢é™©</button>
    </div>

    <div id="stage-intro-screen" class="stage-intro hidden">
        <div class="stage-card">
            <h1 id="intro-title"></h1>
            <h2 id="intro-subtitle" style="color:#f4e7c7; opacity:0.8;"></h2>
            <hr style="border:1px dashed #f4e7c7;">
            <p id="intro-task" style="font-size:1.1em; line-height:1.6;"></p>
            <button onclick="playSnd('click'); beginGame();" style="padding:12px 40px; background:#f4e7c7; color:#a0522d; border:none; font-weight:bold; cursor:pointer; border-radius:5px;">å¼€å§‹æŒ‘æˆ˜</button>
        </div>
    </div>

    <div id="game-container">
        <div id="stage-clear">
            <h2 id="sc-title">æŒ‘æˆ˜æˆåŠŸï¼</h2>
            <p id="sc-msg"></p>
            <div id="sc-info" class="clue-box" style="margin: 20px auto; border-style: dashed;"></div>
            <button class="check-btn" onclick="playSnd('click'); nextAfterClear();">æ”¶ä¸‹ç¢ç‰‡ï¼Œç»§ç»­å‰è¿›</button>
        </div>

        <div id="page-indicator" style="color: #888; font-weight: bold;">ä»»åŠ¡ 1 / 12</div>
        <div id="feedback" style="height:30px; font-weight:bold; margin-bottom:10px;"></div>

        <div id="p1" class="task-page">
            <div class="scene-header"><span>1. ä»»åŠ¡æè¿°ï¼šæœ‰å››ä¸ªäººæƒ³è¿›å…¥çƒåœºï¼Œä»–ä»¬åˆ†åˆ«æ‹¿ç€ä¸™ã€ç”²ã€ä¹™ã€ä¸çš„é—¨ç¥¨ã€‚è¯·æŒ‰æ­£ç¡®é¡ºåºè®©ä»–ä»¬è¿›åœºã€‚</span> <button class="answer-btn" onclick="getHelp('é¡ºåºä¸ºï¼šç”²ã€ä¹™ã€ä¸™ã€ä¸')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>è¯·æŒ‰æ±‰å­—é¡ºåºæ”¾å…¥å¯¹åº”ä½ç½® Remettre dans l'ordreï¼š</p>
            <div class="tray">
                <div class="drop-zone" ondrop="drop(event)" ondragover="allow(event)"></div>
                <div class="drop-zone" ondrop="drop(event)" ondragover="allow(event)"></div>
                <div class="drop-zone" ondrop="drop(event)" ondragover="allow(event)"></div>
                <div class="drop-zone" ondrop="drop(event)" ondragover="allow(event)"></div>
            </div>
            <div class="tray"><div class="draggable" draggable="true" ondragstart="drag(event)">ä¸™</div><div class="draggable" draggable="true" ondragstart="drag(event)">ä¸</div><div class="draggable" draggable="true" ondragstart="drag(event)">ä¹™</div><div class="draggable" draggable="true" ondragstart="drag(event)">ç”²</div></div>
        </div>

        <div id="p2" class="task-page hidden">
            <div class="scene-header"><span>2. è¿›å…¥çƒåœºåï¼Œä½ éœ€è¦æ‰¾åˆ°ä»¥ä¸‹è¿™äº›äººè·å–ä¿¡æ¯ã€‚è¯·å°†äººç‰©ä¸å…¶æè¿°æ­£ç¡®åŒ¹é…ã€‚Trouver des rÃ´les correspondants</span> <button class="answer-btn" onclick="getHelp('è¿åŠ¨å‘˜ã€æ•™ç»ƒã€è£åˆ¤ã€è§‚ä¼—ã€çƒè¿·')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>å‚åŠ æ¯”èµ›çš„äººï¼š<span class="drop-zone" data-ans="è¿åŠ¨å‘˜" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <p>å¸®åŠ©è®­ç»ƒçš„äººï¼š<span class="drop-zone" data-ans="æ•™ç»ƒ" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <p>å†³å®šè¾“èµ¢çš„äººï¼š<span class="drop-zone" data-ans="è£åˆ¤" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <p>è§‚çœ‹æ¯”èµ›çš„äººï¼š<span class="drop-zone" data-ans="è§‚ä¼—" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <p>å–œæ¬¢çƒèµ›çš„äººï¼š<span class="drop-zone" data-ans="çƒè¿·" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <div class="tray"><div class="draggable" draggable="true" ondragstart="drag(event)">è£åˆ¤</div><div class="draggable" draggable="true" ondragstart="drag(event)">çƒè¿·</div><div class="draggable" draggable="true" ondragstart="drag(event)">è§‚ä¼—</div><div class="draggable" draggable="true" ondragstart="drag(event)">è¿åŠ¨å‘˜</div><div class="draggable" draggable="true" ondragstart="drag(event)">æ•™ç»ƒ</div></div>
        </div>

        <div id="p3" class="task-page hidden">
            <div class="scene-header"><span>3. æ¯”èµ›ç»“æŸï¼Œä½ è¢«ä¸´æ—¶å«å»ç»™å‰ä¸‰åå‘å¥–ç‰Œã€‚è¯·å°†å¥–ç‰Œä¸åæ¬¡æ­£ç¡®åŒ¹é…ã€‚Trouver des mÃ©dailles correspondantes</span> <button class="answer-btn" onclick="getHelp('å† å†›è·å¾—é‡‘ç‰Œï¼Œäºšå†›é“¶ç‰Œï¼Œå­£å†›é“œç‰Œ')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>å† å†›ï¼š<span class="drop-zone" data-ans="é‡‘ç‰Œ" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <p>äºšå†›ï¼š<span class="drop-zone" data-ans="é“¶ç‰Œ" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <p>å­£å†›ï¼š<span class="drop-zone" data-ans="é“œç‰Œ" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <div class="tray"><div class="draggable" draggable="true" ondragstart="drag(event)">é“œç‰Œ</div><div class="draggable" draggable="true" ondragstart="drag(event)">é‡‘ç‰Œ</div><div class="draggable" draggable="true" ondragstart="drag(event)">é“¶ç‰Œ</div></div>
        </div>

        <div id="p4" class="task-page hidden">
            <div class="scene-header"><span>4. å·¥ä½œäººå‘˜è¯·ä½ ä¸€èµ·å†™è°œè¯­ï¼Œä»–ä»¬ç»™äº†ä½ ä¸€ä¸ªè°œè¯­ï¼š"ä¸€åŠ ä¸€ï¼Œç‹"ã€‚è¯·å°†å†…å®¹å†™åœ¨æ­£ç¡®çš„ä½ç½®ã€‚</span> <button class="answer-btn" onclick="getHelp('ä¸€åŠ ä¸€æ˜¯è°œé¢ï¼Œç‹æ˜¯è°œåº•')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>â€œä¸€åŠ ä¸€â€æ˜¯ï¼š<input type="text" id="a4-1"></p>
            <p>â€œç‹â€å­—æ˜¯ï¼š<input type="text" id="a4-2"></p>
        </div>

        <div id="p5" class="task-page hidden">
            <div class="scene-header"><span>5. ç°åœºæœ‰ä¿®è¾æ¯”èµ›ï¼Œè¯·ä¸ºä¸‹åˆ—å¥å­é€‰æ‹©æ­£ç¡®çš„ä¿®è¾æ‰‹æ³•ã€‚Trouver figure de style </span> <button class="answer-btn" onclick="getHelp('æ¯”å–»ã€å¤¸å¼ ã€æ‹Ÿäººã€æ’æ¯”')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>1. å¼¯å¼¯æœˆäº®åƒå°èˆ¹ï¼š<select id="a5-1"><option value="">--</option><option>æ¯”å–»</option><option>å¤¸å¼ </option><option>æ‹Ÿäºº</option><option>æ’æ¯”</option></select></p>
            <p>2. ä»–çš„ç¬‘å£°å‡ åƒç±³å¤–å¬åˆ°ï¼š<select id="a5-2"><option value="">--</option><option>æ¯”å–»</option><option>å¤¸å¼ </option><option>æ‹Ÿäºº</option><option>æ’æ¯”</option></select></p>
            <p>3. æ˜Ÿæ˜Ÿåœ¨çœ¨çœ¼ç›ï¼š<select id="a5-3"><option value="">--</option><option>æ¯”å–»</option><option>å¤¸å¼ </option><option>æ‹Ÿäºº</option><option>æ’æ¯”</option></select></p>
            <p>4. å®¶æ˜¯æ¸¯æ¹¾ï¼Œå®¶æ˜¯äº²æƒ…å’Œæ¸©æš–ï¼Œå®¶æ˜¯æœ‰çˆ±åœ¨çš„åœ°æ–¹ï¼š<select id="a5-4"><option value="">--</option><option>æ¯”å–»</option><option>å¤¸å¼ </option><option>æ‹Ÿäºº</option><option>æ’æ¯”</option></select></p>
        </div>

        <div id="p6" class="task-page hidden">
            <div class="scene-header"><span>6. ä½ åˆå‚åŠ äº†è¯è¯­æ¯”èµ›ï¼Œè¯·æŠŠæˆè¯­å¡«å…¥å¥å­çš„æ­£ç¡®ä½ç½®ã€‚</span> <button class="answer-btn" onclick="getHelp('ä¸å±ˆä¸æŒ ã€è¿«ä¸åŠå¾…ã€æµä¼ è‡³ä»Šã€å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>1. ä¸€æ¬¡æ¬¡æ‘”å€’ï¼Œä¸€æ¬¡æ¬¡çˆ¬èµ·æ¥ï¼Œä»–<span class="drop-zone" data-ans="ä¸å±ˆä¸æŒ " ondrop="drop(event)" ondragover="allow(event)"></span> çš„ç²¾ç¥æ„ŸåŠ¨äº†å¤§å®¶ã€‚</p>
            <p>2. æˆ‘ <span class="drop-zone" data-ans="è¿«ä¸åŠå¾…" ondrop="drop(event)" ondragover="allow(event)"></span> åœ°æƒ³è§åˆ°å¥½æœ‹å‹ã€‚</p>
            <p>3. æ˜¥èŠ‚åƒé¥ºå­çš„ä¹ ä¿—ä¸€ç›´ <span class="drop-zone" data-ans="æµä¼ è‡³ä»Š" ondrop="drop(event)" ondragover="allow(event)"></span>ã€‚</p>
            <p>4. æˆ‘è¿™æ¬¡è€ƒè¯•æ²¡è€ƒå¥½ï¼Œä½†æˆ‘ç›¸ä¿¡<span class="drop-zone" data-ans="å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯" ondrop="drop(event)" ondragover="allow(event)"></span>ã€‚</p>
            <div class="tray"><div class="draggable" draggable="true" ondragstart="drag(event)">æµä¼ è‡³ä»Š</div><div class="draggable" draggable="true" ondragstart="drag(event)">ä¸å±ˆä¸æŒ </div><div class="draggable" draggable="true" ondragstart="drag(event)">å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯</div><div class="draggable" draggable="true" ondragstart="drag(event)">è¿«ä¸åŠå¾…</div></div>
        </div>

        <div id="p7" class="task-page hidden">
            <div class="scene-header"><span>7. ä½ éœ€è¦çŸ¥é“ä»€ä¹ˆæ—¶å€™é£é›¨æ‰èƒ½åœä¸‹æ¥ï¼Œä½ æœ‰å“ªäº›æ–¹æ³•å¯ä»¥çŸ¥é“ï¼ŸLes moyens pour savoir la mÃ©tÃ©o</span> <button class="answer-btn" onclick="getHelp('è¯·å†™å‡ºï¼šçœ‹ç”µè§†ï¼Œå¬å¹¿æ’­ï¼Œä¸Šç½‘')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>å†™å‡ºä¸‰ç§è·çŸ¥å¤©æ°”çš„æ–¹æ³•ï¼š</p>
            <input type="text" id="a7-1" style="width: 80%" placeholder="utiliser virgule pour sÃ©parer les rÃ©ponses">
        </div>

        <div id="p8" class="task-page hidden">
            <div class="scene-header"><span>8. ä½ æˆåŠŸç”¨æ‰‹æœºä¸Šç½‘çœ‹åˆ°äº†å¤©æ°”é¢„æŠ¥ï¼Œä½†æ˜¯ä½ å‘ç°ç½‘ä¸Šçš„å¤©æ°”é¢„æŠ¥å˜æˆäº†ä¸€äº›ç”»ï¼Œä½ èƒ½çœ‹æ‡‚å—ï¼Ÿ</span> <button class="answer-btn" onclick="getHelp('é˜´ã€å¤šäº‘ã€é›¨ã€é›ªã€é›·é˜µé›¨ã€é›¨å¤¹é›ª')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>â˜ï¸<span class="drop-zone" data-ans="é˜´" ondrop="drop(event)" ondragover="allow(event)"></span> â›…<span class="drop-zone" data-ans="å¤šäº‘" ondrop="drop(event)" ondragover="allow(event)"></span> ğŸŒ§ï¸<span class="drop-zone" data-ans="é›¨" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <p>â„ï¸<span class="drop-zone" data-ans="é›ª" ondrop="drop(event)" ondragover="allow(event)"></span> â›ˆï¸<span class="drop-zone" data-ans="é›·é˜µé›¨" ondrop="drop(event)" ondragover="allow(event)"></span> ğŸŒ¨ï¸<span class="drop-zone" data-ans="é›¨å¤¹é›ª" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <div class="tray"><div class="draggable" draggable="true" ondragstart="drag(event)">é˜´</div><div class="draggable" draggable="true" ondragstart="drag(event)">é›·é˜µé›¨</div><div class="draggable" draggable="true" ondragstart="drag(event)">å¤šäº‘</div><div class="draggable" draggable="true" ondragstart="drag(event)">é›¨å¤¹é›ª</div><div class="draggable" draggable="true" ondragstart="drag(event)">é›ª</div><div class="draggable" draggable="true" ondragstart="drag(event)">é›¨</div></div>
        </div>

        <div id="p9" class="task-page hidden">
            <div class="scene-header"><span>9. ä½ å‘ç°é›¨å¾ˆå¿«å°±ä¼šåœï¼Œä½†æ™šä¸Šè¿˜è¦æœ‰ä¸€åœºå¤§é›ªï¼Œä½ éœ€è¦å†æ¬¡ç¡®è®¤ä¸€ä¸‹å½“å‰çš„æ¸©åº¦ã€‚æ‰‹æœºä¸Šæ˜¾ç¤ºæ™šä¸Š7ç‚¹çš„æ¸©åº¦æ˜¯ï¼š-1-3Â°ï¼Œè¿™ä¸ªç”¨ä¸­æ–‡åº”è¯¥æ€ä¹ˆè¯´ï¼Ÿ</span> <button class="answer-btn" onclick="getHelp('é›¶ä¸‹ä¸€åˆ°ä¸‰æ‘„æ°åº¦')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>â€œ-1-3Â°â€ ä¸­æ–‡è¯»ä½œï¼š</p>
            <input type="text" id="a9-1" style="width: 260px">
        </div>

        <div id="p10" class="task-page hidden">
            <div class="scene-header"><span>10. å£ç”»ä¸Šåˆ»ç€ä¸€äº›æ–‡å­—ï¼Œä»–ä»¬åˆ†åˆ«ç”¨äº†å“ªäº›é€ å­—æ–¹æ³•</span> <button class="answer-btn" onclick="getHelp('è±¡å½¢ã€æŒ‡äº‹ã€ä¼šæ„ã€å½¢å£°')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>æ—¥ã€å±±ï¼ˆåƒç”»ï¼‰ï¼š<span class="drop-zone" data-ans="è±¡å½¢" ondrop="drop(event)" ondragover="allow(event)"></span> ä¸Šã€ä¸‹ï¼ˆåŠ ä¸€ç¬”ï¼‰ï¼š<span class="drop-zone" data-ans="æŒ‡äº‹" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <p>ä¼‘ã€æ˜ï¼ˆçŸ¥é“æ„æ€ï¼‰ï¼š<span class="drop-zone" data-ans="ä¼šæ„" ondrop="drop(event)" ondragover="allow(event)"></span> æ¸…ã€å¦ˆï¼ˆå½¢æ—+å£°æ—ï¼‰ï¼š<span class="drop-zone" data-ans="å½¢å£°" ondrop="drop(event)" ondragover="allow(event)"></span></p>
            <div class="tray"><div class="draggable" draggable="true" ondragstart="drag(event)">æŒ‡äº‹</div><div class="draggable" draggable="true" ondragstart="drag(event)">å½¢å£°</div><div class="draggable" draggable="true" ondragstart="drag(event)">è±¡å½¢</div><div class="draggable" draggable="true" ondragstart="drag(event)">ä¼šæ„</div></div>
        </div>

        <div id="p11" class="task-page hidden">
            <div class="scene-header"><span>11. ä½ å‘ç°è¿™äº›æ–‡å­—æ—è¾¹å‡ºç°äº†å¾ˆå¤šä¸€æ ·çš„æ±‰å­—ï¼Œä»–ä»¬å¥½åƒæœ‰ä¸åŒçš„è¯»éŸ³ï¼Œä½ çŸ¥é“ä»–ä»¬æ­£ç¡®çš„è¯»éŸ³æ˜¯ä»€ä¹ˆå—ï¼Ÿ</span> <button class="answer-btn" onclick="getHelp('æ›´æ”¹è¯»geng1ï¼Œæ›´å¥½è¯»geng4')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>1. â€œæ›´ï¼ˆ  ï¼‰æ”¹ã€æ›´ï¼ˆ   ï¼‰æ¢â€ï¼š<label><input type="radio" name="g1" value="1"> gÄ“ng</label> <label><input type="radio" name="g1" value="4"> gÃ¨ng</label></p>
            <p>2. â€œæ›´ï¼ˆ   ï¼‰å¥½ã€æ›´ï¼ˆ    ï¼‰åŠ â€ï¼š<label><input type="radio" name="g2" value="1"> gÄ“ng</label> <label><input type="radio" name="g2" value="4"> gÃ¨ng</label></p>
        </div>

        <div id="p12" class="task-page hidden">
            <div class="scene-header"><span>12. ğŸ“œ ä½ ç»§ç»­å¾€å‰èµ°ï¼Œä½ å‘ç°åœ°ä¸Šä¸Šæ”¾ç€ä¸€æœ¬å­—å…¸ğŸ“•å’Œä¸€å¼ å­—æ¡ï¼ŒğŸ“œä¸Šé¢å†™ç€ï¼šä¸‰æ›´é¾Ÿç”²ã€‚ä½ çŸ¥é“â€œæ›´â€çš„è¯»éŸ³ï¼Œä¸è®¤è¯†â€œé¾Ÿâ€è¿™ä¸ªå­—ï¼Œä½ éœ€è¦ç”¨å­—å…¸æŸ¥å‡ºè¿™ä¸¤ä¸ªå­—çš„æ„æ€</span> <button class="answer-btn" onclick="getHelp('æ›´æŸ¥éŸ³åºï¼Œé¾ŸæŸ¥éƒ¨é¦–')">ğŸ’¡ ç­”æ¡ˆ</button></div>
            <p>æŸ¥â€œæ›´â€å­—ï¼Œè¦ç”¨ï¼š<select id="m1"><option value="">--</option><option value="y">éŸ³åºæ£€å­—æ³•</option><option value="b">éƒ¨é¦–æ£€å­—æ³•</option></select></p>
            <p>æŸ¥â€œé¾Ÿâ€å­—ï¼Œè¦ç”¨ï¼š<select id="m2"><option value="">--</option><option value="y">éŸ³åºæ£€å­—æ³•</option><option value="b">éƒ¨é¦–æ£€å­—æ³•</option></select></p>
        </div>

        <div id="final-page" class="task-page hidden" style="text-align:center;">
            <h1>ğŸ† æ¢é™©ç»ˆç‚¹</h1>
            <div id="final-clues"></div>
            <h2 id="final-msg" style="color:#a0522d; margin-top:30px;"></h2>
            <button onclick="location.reload()" class="check-btn">é‡å¯æ¢é™© Reprendre le voyage</button>
        </div>

        <div class="btn-group" id="nav-group">
            <button class="nav-btn" onclick="playSnd('click'); changeTask(-1)" id="prevBtn" disabled>ä¸Šä¸€æ­¥</button>
            <button class="check-btn" onclick="validate()">éªŒè¯ç­”æ¡ˆ VÃ©rifier les rÃ©ponses</button>
            <button class="nav-btn" onclick="playSnd('click'); changeTask(1)" id="nextBtn" disabled>ä¸‹ä¸€æ­¥</button>
        </div>
    </div>

    <script>
        let cur = 1;
        let clues = [null, null, null, null];
        let usedHelp = Array(12).fill(false);

        function playSnd(id) {
            const s = document.getElementById('snd-' + id);
            if(s) { s.currentTime = 0; s.play().catch(()=>{}); }
        }

        function initGame() {
            document.getElementById('bgm').play().catch(()=>{});
            playSnd('click');
            showIntro(1);
        }

        const stageData = {
            1: { title: "ç¬¬ä¸€å¤§å…³ï¼šçƒ­è¡€çƒåœº", sub: "ä½ æ¥åˆ°ç¯®çƒæ¯”èµ›ç°åœºï¼Œéœ€è¦å®Œæˆä¸‰ä¸ªä»»åŠ¡æ‰èƒ½è·å¾—å…³é”®ä¿¡æ¯", task: "æ’åºã€è¯†åˆ«è§’è‰²ä¸é¢å‘å¥–ç‰Œã€‚" },
            4: { title: "ç¬¬äºŒå¤§å…³ï¼šç¯ç¬¼èŠ‚", sub: "ä½ æ¥åˆ°äº†ä¸€ä¸ªæŒ‚æ»¡ç¯ç¬¼çš„åœ°æ–¹ï¼Œè¿™é‡Œæ­£åœ¨ä¸¾åŠæ–‡åŒ–æ´»åŠ¨ï¼Œéœ€è¦å®Œæˆä¸‰ä¸ªä»»åŠ¡æ‰èƒ½è·å¾—å…³é”®ä¿¡æ¯", task: "æ‹†è§£ç¯è°œï¼ŒæŒæ¡ä¿®è¾ä¸æˆè¯­ã€‚" },
            7: { title: "ç¬¬ä¸‰å¤§å…³ï¼šé£é›¨äº¤åŠ çš„å¤œæ™š", sub: "ä½ åœ¨å»ä¸‹ä¸€ä¸ªå…³å¡çš„è·¯ä¸Šï¼Œçªç„¶åˆ®èµ·äº†å¤§é£ï¼Œä¸‹èµ·äº†æš´é›¨ï¼Œä½ ä¸å¾—ä¸æ‰¾ä¸ªåœ°æ–¹èº²é›¨ã€‚", task: "è·å–æ°”è±¡ã€è¯†åˆ«ç¬¦å·ä¸è¯»æ³•ã€‚" },
            10: { title: "ç¬¬å››å¤§å…³ï¼šæ´ç©´æ¢ç§˜", sub: "ä½ è¿›å…¥æ´ç©´èº²é¿é£é›ªï¼Œå‘ç°æ´ç©´æ·±å¤„æœ‰å¾®å…‰ï¼Œèµ°è¿‘ä¸€çœ‹ï¼Œæ˜¯ä¸€äº›å‘å…‰çš„å£ç”»ï¼Œä¸Šé¢å†™ç€ä¸€äº›æ–‡å­—ã€‚", task: "é€ å­—æº¯æºã€å¤šéŸ³å­—ä¸æ£€ç´¢æ³•ã€‚" }
        };

        function showIntro(s) {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('stage-intro-screen').classList.remove('hidden');
            document.getElementById('intro-title').innerText = stageData[s].title;
            document.getElementById('intro-subtitle').innerText = "åœºæ™¯ï¼š" + stageData[s].sub;
            document.getElementById('intro-task').innerText = "ç›®æ ‡ï¼š" + stageData[s].task;
        }

        function beginGame() {
            document.getElementById('stage-intro-screen').classList.add('hidden');
            document.getElementById('game-container').style.display = 'block';
        }

        function getHelp(msg) {
            playSnd('click');
            alert("ã€å¤©ä¹¦ã€‘ï¼š\n" + msg);
            usedHelp[cur - 1] = true;
            document.getElementById('nextBtn').disabled = false;
        }

        function validate() {
            let ok = false;
            const f = document.getElementById('feedback');

            // --- æ–°å¢ï¼šæ¯ä¸ªä»»åŠ¡å¯¹åº”çš„é¼“åŠ±è¯­å­—å…¸ ---
            const encouragementMap = {
                1: "âœ… æ£€ç¥¨æˆåŠŸï¼ä½ æˆåŠŸç»´æŒäº†èµ›åœºçš„ç§©åº",
                2: "âœ… è¯†åˆ«å‡†ç¡®ï¼çƒåœºä¸Šçš„äººé™…å…³ç³»éƒ½éš¾ä¸å€’ä½ ï¼",
                3: "âœ… é¢å¥–å®Œæ¯•ï¼çƒå‘˜ä»¬æ‹¿åˆ°äº†ä»–ä»¬çš„å¥–ç‰Œï¼ä»–ä»¬æŠŠä¸‹ä¸€ç«™ç›®çš„åœ°å‘Šè¯‰äº†ä½ ã€‚",
                4: "âœ… ç ´è§£ç¯è°œï¼å·¥ä½œäººå‘˜éå¸¸æ„Ÿè°¢ä½ çš„å¸®å¿™ï¼Œå‘Šè¯‰ä½ åœ¨è¿™é‡Œä½ è‡³å°‘è¦å‚åŠ ä¸¤ä¸ªæ¯”èµ›æ‰èƒ½æ‹¿åˆ°çº¿ç´¢ï¼",
                5: "âœ… ä¿®è¾å¤§å¸ˆï¼ä½ æˆåŠŸå®Œæˆäº†ç¬¬ä¸€ä¸ªæ¯”èµ›ï¼",
                6: "âœ… å¦™ç¬”ç”ŸèŠ±ï¼ç¬¬äºŒä¸ªæ¯”èµ›æŒ‘æˆ˜æˆåŠŸï¼Œä½ å‰å¾€ä¸‹ä¸€ä¸ªç›®çš„åœ°ã€‚",
                7: "âœ… æ™ºæ…§ç”Ÿå­˜ï¼ä½ å¾ˆæ“…é•¿åœ¨å›°å¢ƒä¸­å¯»æ‰¾ä¿¡æ¯ï¼",
                8: "âœ… æ°”è±¡ä¸“å®¶ï¼ç°åœ¨ä½ é£é›¨æ— ç•äº†ï¼ä½ è§‰å¾—é©¬ä¸Šå‡ºå‘å»å‰é¢çš„æ´ç©´é‡Œèº²é¿é£é›ªã€‚",
                9: "âœ… è¯»æ³•å‡†ç¡®ï¼ä½ ç©¿å¥½è¡£æœåšå¥½é˜²å¯’ä¿æš–çš„å·¥ä½œï¼Œå‡ºå‘ï¼",
                10: "âœ… æº¯æºæˆåŠŸï¼å£ç”»èƒŒåçš„é€ å­—æ³•è¢«ä½ è¯†ç ´äº†ï¼",
                11: "âœ… è¾¨éŸ³é«˜æ‰‹ï¼å¤šéŸ³å­—å†ä¹Ÿè¿·æƒ‘ä¸äº†ä½ ï¼",
                12: "âœ… æ£€å­—å°è¾¾äººï¼ä½ å·²ç»å­¦ä¼šå¦‚ä½•ä½¿ç”¨å­—å…¸äº†ï¼"
            };

            if([1, 2, 3, 6, 8, 10].includes(cur)) {
                let allFilled = true;
                let allCorrect = true;
                document.querySelectorAll(`#p${cur} .drop-zone`).forEach(z => {
                    if(!z.innerText || z.innerText.trim() === "") allFilled = false;
                    if(cur === 1) { }
                    else if(z.innerText !== z.dataset.ans) allCorrect = false;
                });
                
                if(cur === 1) {
                    let r = ""; document.querySelectorAll('#p1 .drop-zone').forEach(z => r += z.innerText);
                    ok = (r === "ç”²ä¹™ä¸™ä¸");
                } else {
                    ok = allFilled && allCorrect;
                }
            } 
            else if(cur === 4) {
                let v1 = document.getElementById('a4-1').value.trim();
                let v2 = document.getElementById('a4-2').value.trim();
                if(v1 !== "" && v2 !== "" && v1.includes("é¢") && v2.includes("åº•")) ok = true;
            } 
            else if(cur === 7) {
                let val = document.getElementById('a7-1').value.trim();
                let inputWords = val.split(/[ï¼Œ, ï¼›;ã€\s]+/).filter(w => w !== "");
                let required = ["çœ‹ç”µè§†", "å¬å¹¿æ’­", "ä¸Šç½‘"];
                if (inputWords.length === 3) {
                    ok = required.every(word => inputWords.includes(word)) && 
                         inputWords.every(word => required.includes(word));
                }
            } 
            else if(cur === 9) {
                let v = document.getElementById('a9-1').value.trim();
                if(v.includes("é›¶ä¸‹") && (v.includes("ä¸‰") || v.includes("3"))) ok = true;
            }
            else if(cur === 5) {
                let s1 = document.getElementById('a5-1').value;
                let s2 = document.getElementById('a5-2').value;
                let s3 = document.getElementById('a5-3').value;
                let s4 = document.getElementById('a5-4').value;
                if(s1==="æ¯”å–»" && s2==="å¤¸å¼ " && s3==="æ‹Ÿäºº" && s4==="æ’æ¯”") ok = true;
            } else if(cur === 12) {
                if(document.getElementById('m1').value==="y" && document.getElementById('m2').value==="b") ok = true;
            }
            else if(cur === 11) {
                let r1 = document.querySelector('input[name="g1"]:checked')?.value;
                let r2 = document.querySelector('input[name="g2"]:checked')?.value;
                if(r1 === "1" && r2 === "4") ok = true;
            }

            if(ok) {
                playSnd('success');
                // ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„é¼“åŠ±è¯­
                f.innerText = encouragementMap[cur]; 
                f.style.color = "green";
                document.getElementById('nextBtn').disabled = false;
                if([3, 6, 9, 12].includes(cur)) checkStageClear();
            } else {
                playSnd('fail');
                f.innerText = "âŒ è¿˜æ²¡ç ´è§£æˆåŠŸå“¦ï¼Œå†æ£€æŸ¥ä¸€ä¸‹ï¼Ÿ"; f.style.color = "red";
            }
        }

        function checkStageClear() {
            let g = Math.floor((cur-1)/3);
            let cheated = usedHelp[g*3] || usedHelp[g*3+1] || usedHelp[g*3+2];
            if(!cheated) {
                const map = ["è€å¸ˆ", "æœ‰", "ç›²", "ç›’"];
                clues[g] = map[g];
                document.getElementById('sc-info').innerText = map[g];
                document.getElementById('sc-msg').innerText = "å¤ªæ£’äº†ï¼ä½ å‡­å€Ÿæ™ºæ…§è·å¾—äº†çº¿ç´¢ã€‚Bravoï¼Vous avez obtenu un indice";
            } else {
                clues[g] = null;
                document.getElementById('sc-info').innerText = "ï¼Ÿ";
                document.getElementById('sc-msg').innerText = "æ›¾æ±‚åŠ©å¤©ä¹¦ï¼Œæœ¬é˜¶æ®µç¢ç‰‡æ— æ³•è·å¾—ã€‚Malheureusement,comme vous avez consultÃ© des rÃ©ponses, vous ne pouvez pas obtenir l'indice ";
            }
            document.getElementById('stage-clear').style.display = 'block';
        }

        function nextAfterClear() {
            document.getElementById('stage-clear').style.display = 'none';
            if(cur < 12) {
                if([3, 6, 9].includes(cur)) showIntro(cur + 1);
                else changeTask(1);
            } else { showFinal(); }
        }

        function changeTask(step) {
            document.getElementById(`p${cur}`).classList.add('hidden');
            cur += step;
            document.getElementById(`p${cur}`).classList.remove('hidden');
            document.getElementById('page-indicator').innerText = `ä»»åŠ¡ ${cur} / 12`;
            document.getElementById('feedback').innerText = "";
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('prevBtn').disabled = (cur === 1);
        }

        function showFinal() {
            document.getElementById('nav-group').classList.add('hidden');
            const box = document.getElementById('final-clues');
            box.innerHTML = ""; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹é˜²æ­¢é‡å¤
            clues.forEach(c => { box.innerHTML += `<div class="clue-box">${c ? c : "?"}</div>`; });
            document.getElementById('final-msg').innerText = clues.filter(c=>c).length === 4 ? "ç»ˆæç§˜å¯†ï¼šè€å¸ˆæœ‰ç›²ç›’ï¼" : "æ¢é™©ç»“æŸï¼ŒçœŸç›¸ä»æœªå¤§ç™½ã€‚";
            document.getElementById('final-page').classList.remove('hidden');
        }

        function allow(ev) { ev.preventDefault(); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.innerText); }
        function drop(ev) { 
            ev.preventDefault(); 
            ev.target.innerText = ev.dataTransfer.getData("text"); 
            playSnd('click');
        }
    </script>
</body>
</html>